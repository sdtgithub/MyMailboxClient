/*! Copyright (c) 2018 CommonTime Ltd */
/*! Build date: Tue Jun 12 2018 14:27:37 GMT+0100 (GMT Daylight Time) */
/*! ================================= */
/*! Commit hash: 674ce6b (674ce6b1400b6767a89beef52cc5617de11129fb) */
/*! Commit date: Tue Jun 12 2018 08:59:46 GMT+0100 (GMT Daylight Time) */
/*! Commit branch: release/3.2.0-beta10-840 */
/*! ================================= */

"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(){customElements.define("ct-data-col",function(t){function e(t){var n,o;return _classCallCheck(this,e),o=t=n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),_possibleConstructorReturn(n,o)}return _inherits(e,t),e}(HTMLElement))}();
/*! Copyright (c) 2018 CommonTime Ltd */
/*! Build date: Tue Jun 12 2018 14:27:37 GMT+0100 (GMT Daylight Time) */
/*! ================================= */
/*! Commit hash: 674ce6b (674ce6b1400b6767a89beef52cc5617de11129fb) */
/*! Commit date: Tue Jun 12 2018 08:59:46 GMT+0100 (GMT Daylight Time) */
/*! Commit branch: release/3.2.0-beta10-840 */
/*! ================================= */

"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}();!function(){customElements.define("ct-data-grid",function(t){function e(t){var a,i;return _classCallCheck(this,e),t=a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),t.localData=null,t.model={cols:[],data:[]},t.isReady=!1,i=t,_possibleConstructorReturn(a,i)}return _inherits(e,t),_createClass(e,[{key:"injectStyles",value:function(){var t=document.head.querySelector("style[rel="+this.tagName.toLowerCase()+"]");t||(t=document.createElement("style"),t.setAttribute("rel",this.tagName.toLowerCase()),t.textContent='@keyframes ctDataGridSpin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}ct-data-grid{display:flex;position:relative;flex:1}ct-data-grid ct-data-col{display:none;position:absolute;top:-9999px;left:-9999px;width:0;height:0}ct-data-grid .ct-data-grid{position:relative;top:0;left:0;width:100%;height:auto;max-height:100%;display:flex;flex-direction:column}ct-data-grid .ct-data-grid .search-area{display:none;flex:0 0 auto;margin:0 0 20px 0}ct-data-grid .ct-data-grid .table-area{position:relative;min-height:.01%;overflow-x:auto;-webkit-overflow-scrolling:touch}ct-data-grid .ct-data-grid .table-area .table-container table{margin:0;width:100%}ct-data-grid .ct-data-grid .table-area .table-container table td,ct-data-grid .ct-data-grid .table-area .table-container table th{position:relative}ct-data-grid .ct-data-grid .table-area .table-container table th{user-select:none;white-space:nowrap}ct-data-grid .ct-data-grid .table-area .table-container table th.sortable{cursor:pointer}ct-data-grid .ct-data-grid .table-area .table-container table th.sortable:after{content:"\\f0dc";font-family:"FontAwesome";display:inline-block;vertical-align:middle;font-size:0.8em;width:20px;text-align:right;opacity:0.3}ct-data-grid .ct-data-grid .table-area .table-container table th.sortable.sort-asc:after{content:"\\f0de";opacity:1}ct-data-grid .ct-data-grid .table-area .table-container table th.sortable.sort-desc:after{content:"\\f0dd";opacity:1}ct-data-grid .ct-data-grid .table-area .table-container table td{padding:0}ct-data-grid .ct-data-grid .table-area .table-container table td .content{display:block;padding:8px}ct-data-grid .ct-data-grid .table-area .table-container table td .control{display:block;padding:5px}ct-data-grid .ct-data-grid .table-area .table-container table td .control input{line-height:normal}ct-data-grid .ct-data-grid .table-area .table-container table td .edit-controls{display:block;padding:7px}ct-data-grid .ct-data-grid .table-area .table-container table td .edit-controls button{margin:0 0 0 5px}ct-data-grid .ct-data-grid .table-area .table-container table td .edit-controls button:first-child{margin:0}ct-data-grid .ct-data-grid .table-area .table-container table td .message-detail{font-size:0.8em}ct-data-grid .ct-data-grid .table-area .table-container table td .edit-control{width:100%}ct-data-grid .ct-data-grid .table-area .table-container table td.message-info{padding-left:30px}ct-data-grid .ct-data-grid .table-area .table-container table td.message-info:before{content:"\\f05a";font-family:"FontAwesome";display:block;position:absolute;top:9px;left:9px}ct-data-grid .ct-data-grid .table-area .table-container table td.message-error{background:#f2dede;padding-left:30px}ct-data-grid .ct-data-grid .table-area .table-container table td.message-error:before{content:"\\f06a";font-family:"FontAwesome";display:block;position:absolute;top:9px;left:9px}ct-data-grid .ct-data-grid .table-area .table-container table.selection-mode-row tr.selected,ct-data-grid .ct-data-grid .table-area .table-container table.selection-mode-cell tr.selected{background-color:#d9edf7}ct-data-grid .ct-data-grid .table-area .table-container table.selection-mode-row td,ct-data-grid .ct-data-grid .table-area .table-container table.selection-mode-cell td{cursor:pointer}ct-data-grid .ct-data-grid .table-area .table-container table.selection-mode-cell td.selected{background-color:rgba(0,0,0,0.05)}ct-data-grid .ct-data-grid .table-area.fixed-headers{display:flex}ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container{display:flex;flex:1}ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table{display:flex;flex-direction:column;table-layout:fixed;flex:1}ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table thead{display:block;flex:0 0 auto}ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table thead tr{display:flex}ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table tbody{display:block;flex:1 1 auto;overflow:auto}ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table tbody tr{display:flex}ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table tbody tr:first-child td{border-top:0}ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table td,ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table th{flex:1;overflow:hidden}ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table td .content,ct-data-grid .ct-data-grid .table-area.fixed-headers .table-container table th .content{text-overflow:ellipsis;overflow:hidden}ct-data-grid .ct-data-grid .pagination-area{flex:0 0 auto;display:none;user-select:none;margin:20px 0 0 0}ct-data-grid .ct-data-grid .loading{position:absolute;top:0;left:0;width:100%;height:100%;display:none}ct-data-grid .ct-data-grid.has-search .search-area{display:flex;justify-content:flex-end}ct-data-grid .ct-data-grid.has-search .search-area .search-bar .search-box{position:relative;width:400px}ct-data-grid .ct-data-grid.has-search .search-area .search-bar .search-box input.form-control{z-index:1;padding-right:24px}ct-data-grid .ct-data-grid.has-search .search-area .search-bar .search-box .clear-button{position:absolute;top:0;right:34px;width:24px;height:100%;padding:8px 0 0 0;text-align:center;z-index:2;cursor:pointer;opacity:0.5;font-size:0.8em}ct-data-grid .ct-data-grid.has-search .search-area .search-bar .search-box .clear-button:hover{opacity:1}ct-data-grid .ct-data-grid.has-pagination .pagination-area{display:flex;justify-content:center}ct-data-grid .ct-data-grid.has-pagination .pagination-area ul.pagination{display:block;margin:0}ct-data-grid .ct-data-grid.has-pagination .pagination-area ul.pagination .page-bookend .page-label{display:none}ct-data-grid .ct-data-grid.has-pagination .pagination-area ul.pagination li>a{min-width:40px;text-align:center;cursor:pointer}ct-data-grid .ct-data-grid.loading-data .loading{display:block}ct-data-grid .ct-data-grid.loading-data .loading .bg{width:100%;height:100%;background:#ffffff;opacity:0.5}ct-data-grid .ct-data-grid.loading-data .loading .spinner{position:absolute;top:50%;left:50%;width:32px;height:32px;border:1px solid #cccccc;border-radius:50%;margin:-16px 0 0 -16px;background:#ffffff}ct-data-grid .ct-data-grid.loading-data .loading .spinner:after{content:"";display:block;position:absolute;width:24px;height:24px;top:50%;left:50%;margin:-12px 0 0 -12px;border:3px solid rgba(0,0,0,0.2);border-left-color:#000000;border-radius:50%;transform:translateZ(0);animation:ctDataGridSpin 1.1s infinite linear}\n                ',document.head.appendChild(t))}},{key:"generateHtml",value:function(){return'<div class="ct-data-grid">\n                <div class="search-area"></div>\n                <div class="table-area">\n                    <div class="table-container"></div>\n                    <div class="loading"></div>\n                </div>\n                <div class="pagination-area"></div>\n            </div>'}}]),_createClass(e,[{key:"connectedCallback",value:function(){var t=this,e=this.getAttribute("id")||"autoid"+(new Date).getTime(),a=Array.from(this.querySelectorAll("ct-data-col"));a.forEach(function(e){t.model.cols.push({key:e.getAttribute("key"),classes:e.getAttribute("class")||"",displayKey:e.getAttribute("display-key"),cssKey:e.getAttribute("css-key"),heading:e.textContent,dataType:e.getAttribute("data-type")||"string",sortable:e.hasAttribute("sortable")&&"false"!==e.getAttribute("sortable"),sort:e.getAttribute("sort"),width:e.getAttribute("width"),editable:e.hasAttribute("editable")&&"false"!==e.getAttribute("editable"),isControls:"controls"===e.getAttribute("data-type"),editButtonLabel:e.getAttribute("edit-button-label")||"Edit",saveButtonLabel:e.getAttribute("save-button-label")||"Save",cancelButtonLabel:e.getAttribute("cancel-button-label")||"Cancel"})}),this.id=e,this.injectStyles(),this.innerHTML=this.generateHtml(),a.forEach(function(e){t.appendChild(e)}),this.$element=this.querySelector(".ct-data-grid"),this.$searchArea=this.querySelector(".search-area"),this.$tableArea=this.querySelector(".table-area"),this.$tableContainer=this.querySelector(".table-container"),this.$paginationArea=this.querySelector(".pagination-area"),this.$loading=this.querySelector(".loading"),this._initialize(),this._raiseEvent("ready"),this.isReady=!0}},{key:"attributeChangedCallback",value:function(t,e,a){if(this.isReady&&e!==a){var i=!1,r=!1,s=!1;switch(t.toLowerCase()){case"data-source":case"data-source-method":case"data-source-page-param":case"data-source-page-size-param":case"data-source-search-param":case"data-source-sort-column-param":case"data-source-sort-direction-param":case"data-results-property":case"data-results-total-property":this._processDataSourceAttributes(),this._processInteractionAttributes(),s=!0;break;case"show-search":this._processSearchAttributes(),i=!0,r=!0;break;case"show-pagination":this._processPaginationAttributes(),i=!0,s=!0;break;case"page-size":this._processPaginationAttributes(),s=!0;break;case"use-local-interaction":this._processInteractionAttributes(),s=!0;break;case"fixed-headers":this._processPresentationAttributes(),i=!0,r=!0;break;case"row-css-key":this._processPresentationAttributes(),r=!0;break;case"selection-mode":this._processInteractionAttributes(),i=!0,r=!0}if(i&&this._render(!0),r||s){var n=!s;this._buildDataRows(n)}}}},{key:"_initialize",value:function(){this._processDataSourceAttributes(),this._processSearchAttributes(),this._processPaginationAttributes(),this._processInteractionAttributes(),this._processPresentationAttributes(),this.searchQuery="",this.sortBy=null,this.sortDirection=null,this.pageNumber=1,this.unfilteredTotalResults=0,this.totalResults=0,this.selectedValue=null,this._render()}},{key:"_processDataSourceAttributes",value:function(){this.dataSourceUrl=this.getAttribute("data-source"),this.dataSourceMethod=this.getAttribute("data-source-method")||"GET",this.dataSourcePageParam=this.getAttribute("data-source-page-param")||"page",this.dataSourcePageSizeParam=this.getAttribute("data-source-page-size-param")||"limit",this.dataSourceSearchParam=this.getAttribute("data-source-search-param")||"query",this.dataSourceSortColumnParam=this.getAttribute("data-source-sort-column-param")||"sort",this.dataSourceSortDirectionParam=this.getAttribute("data-source-sort-direction-param")||"dir",this.dataResultsProperty=this.getAttribute("data-results-property")||"data",this.dataResultsTotalProperty=this.getAttribute("data-results-total-property")||"totalResults",this.useDataSource=!!this.dataSourceUrl,this.dataSourceParams=null}},{key:"_processInteractionAttributes",value:function(){this.useLocalInteraction=!this.useDataSource||this.hasAttribute("use-local-interaction")&&"false"!==this.getAttribute("use-local-interaction").toLowerCase(),this.selectionMode=(this.getAttribute("selection-mode")||"none").toLowerCase()}},{key:"_processSearchAttributes",value:function(){this.showSearch=this.hasAttribute("show-search")&&"false"!==this.getAttribute("show-search").toLowerCase()}},{key:"_processPaginationAttributes",value:function(){this.showPagination=!this.hasAttribute("show-pagination")||"false"!==this.getAttribute("show-pagination").toLowerCase(),this.pageSize=parseInt(this.getAttribute("page-size"))||0}},{key:"_processPresentationAttributes",value:function(){this.fixedHeaders=this.hasAttribute("fixed-headers")&&"false"!==this.getAttribute("fixed-headers").toLowerCase(),this.rowCssKey=this.getAttribute("row-css-key")||"",this.$tableArea&&this.$tableArea.classList.toggle("fixed-headers",this.fixedHeaders)}},{key:"_render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e._removeChildren(this.$tableContainer),this._buildSearchArea(),this._buildTable(t),this.$tableContainer.appendChild(this.$table)}},{key:"_loadDataFromUrl",value:function(){var t=this,a=this;return new Promise(function(i){a._setLoading(!0),a.dataSourceParams={},t.useLocalInteraction||(a.searchQuery&&(a.dataSourceParams[a.dataSourceSearchParam]=a.searchQuery),null!==a.sortBy&&(a.dataSourceParams[a.dataSourceSortColumnParam]=a.sortBy,a.dataSourceParams[a.dataSourceSortDirectionParam]=a.sortDirection),a.pageSize&&a.pageNumber&&(a.dataSourceParams[a.dataSourcePageSizeParam]=a.pageSize,a.dataSourceParams[a.dataSourcePageParam]=a.pageNumber)),a._sendRequest(a.dataSourceMethod,a.dataSourceUrl,a.dataSourceParams).then(function(t){var r=e._getProperty(t,a.dataResultsProperty);Array.isArray(r)||(a._setLoading(!1),a._setMessage("error","Incorrect data retrieved, must be array; was "+("undefined"==typeof r?"undefined":_typeof(r))),a._raiseEvent("data-error"),i(!1));var s=e._getProperty(t,a.dataResultsTotalProperty);a.unfilteredTotalResults=s||r.length,a.totalResults=s||r.length,a._setLoading(!1),a._setData(r),i(!0)},function(t){a._setLoading(!1),a._setMessage("error","Error loading data...",t),a._raiseEvent("data-error"),i(!1)})})}},{key:"_prepareLocalData",value:function(){var t=this;return new Promise(function(e){var a=Array.from(t.localData||[]);a=t._searchLocal(a),t.totalResults=a.length,a=t._sortLocal(a),a=t._paginateLocal(a),t._setData(a),e(!0)})}},{key:"_buildTable",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];switch(this.$table=document.createElement("table"),this.$table.classList.add("table","table-striped","table-hover"),this.selectionMode){case"row":this.$table.classList.add("selection-mode-row");break;case"cell":this.$table.classList.add("selection-mode-cell")}this.fixedHeaders&&this.$tableArea.classList.add("fixed-headers"),this.$thead=document.createElement("thead"),this.$table.appendChild(this.$thead);var a=document.createElement("tr");this.model.cols.forEach(function(e){return t._buildColumnHeader(a,e)}),this.$thead.appendChild(a),this.$tbody=document.createElement("tbody"),this.$table.appendChild(this.$tbody),this.useDataSource&&!1===e&&this._buildDataRows()}},{key:"_buildColumnHeader",value:function(t,e){var a=this,i=document.createElement("th");e.key&&i.setAttribute("key",e.key),void 0!==e.classes&&null!==e.classes&&e.classes.toString().split(" ").forEach(function(t){t&&i.classList.add(t)}),e.isControls&&i.classList.add("edit-controls"),null!==e.width&&(this.fixedHeaders?i.style.flex="1 1 "+e.width:i.style.width=e.width),e.sortable&&!e.isControls&&(i.classList.add("sortable"),e.key===this.sortBy?this._changeSort(i,this.sortDirection,!0):!this.sortBy&&(e.sort&&"asc"===e.sort.toString().toLowerCase()&&this._changeSort(i,"asc",!0),e.sort&&"desc"===e.sort.toString().toLowerCase()&&this._changeSort(i,"desc",!0)),i.addEventListener("click",function(){a._changeSort(i)})),i.textContent=e.heading,t.appendChild(i)}},{key:"_buildDataRows",value:function(){var t=this,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=void 0;i=a?Promise.resolve(!!this.model.data):this.useDataSource&&this.useLocalInteraction&&null===this.localData?this._loadDataFromUrl().then(function(){return t.localData=t.model.data,t.unfilteredTotalResults=t.localData.length,t.totalResults=t.localData.length,t._prepareLocalData()}):this.useLocalInteraction?this._prepareLocalData():this._loadDataFromUrl(),i.then(function(a){a&&(e._removeChildren(t.$tbody),0<t.model.data.length?t.model.data.forEach(function(e,a){return t._buildDataRow(e,a)}):t._setMessage("info","No data to display..."),t._buildPagination(),t._raiseEvent("data-rendered"))})}},{key:"_buildDataRow",value:function(t,e){var a=this,i=this._applyIndexes(t).__idx,r=document.createElement("tr");if(this.rowCssKey&&t.hasOwnProperty(this.rowCssKey)&&void 0!==t[this.rowCssKey]&&null!==t[this.rowCssKey]){var s=t[this.rowCssKey].toString().split(" ");s.forEach(function(t){t&&r.classList.add(t)})}this._isEditItem(i)&&r.classList.add("editing"),this.model.cols.forEach(function(s,n){a._buildDataCell(r,s,n,t,e,i)}),"row"===this.selectionMode&&r.addEventListener("click",function(){return a.__handleRowClick(r,t,e)}),this.$tbody.appendChild(r)}},{key:"_buildDataCell",value:function(t,a,i,r,s,n){var o=this,l=document.createElement("td");if(void 0!==a.classes&&null!==a.classes&&a.classes.toString().split(" ").forEach(function(t){t&&l.classList.add(t)}),a.cssKey&&r.hasOwnProperty(a.cssKey)&&void 0!==r[a.cssKey]&&null!==r[a.cssKey]){var d=r[a.cssKey].toString().split(" ");d.forEach(function(t){t&&l.classList.add(t)})}void 0!==a.width&&(this.fixedHeaders?l.style.flex="1 1 "+a.width:l.style.width=a.width),t.appendChild(l),"cell"!==this.selectionMode||a.isControls||l.addEventListener("click",function(){return o.__handleCellClick(l,r,s,a,i)});var c=document.createElement("div"),u=!1;this.editManifest&&this.editManifest.itemIndexes.length&&(a.editable||a.isControls)&&(u=this.editManifest.itemIndexes.includes(n));var h=a.isControls?"edit-controls":u?"control":"content";c.classList.add(h),u?(e._removeChildren(c),a.isControls?this._buildEditButtons(c,a,!1,n):this._buildEditControl(c,a,r[a.key],this.editManifest[n])):a.isControls?this._buildEditButtons(c,a,!0,n):a.displayKey?c.innerHTML=r[a.displayKey]||"":c.innerHTML=this._formatData(a,r[a.key]),l.appendChild(c)}},{key:"_formatData",value:function(t,a){var i=this,r="";switch((t.dataType||"").toLowerCase()){case"string":!function(){r=a||""}();break;case"number":!function(){var t=parseFloat(a);isNaN(t)||(r=t.toString())}();break;case"date":!function(){if(void 0!==a&&null!==a&&""!==a){var t=e._parseDate(a);t&&(r=e._renderDate(t))}}();break;case"datetime":!function(){if(void 0!==a&&null!==a&&""!==a){var t=isNaN(a)?a.substring(0,19):a,i=e._parseDate(t);i&&(r=e._renderDate(i)+" "+e._renderTime(i))}}();break;case"boolean":!function(){!0===a?r="Yes":!1===a&&(r="No")}();break;case"url":!function(){a&&(r='<a href="'+a+'" target="_'+i.id+"_"+t.key+'_link">Link</a>')}()}return r}},{key:"_buildEditButtons",value:function(t,e,a,i){var r=this;if(a){var s=document.createElement("button");s.classList.add("btn","btn-xs","btn-default","edit-button"),s.innerHTML='<span class="text">'+e.editButtonLabel+"</span>",s.addEventListener("click",function(t){t.stopPropagation(),r._addEditModeItems([i])}),t.appendChild(s)}else{var n=document.createElement("button");n.classList.add("btn","btn-xs","btn-default","save-button"),n.innerHTML='<span class="text">'+e.saveButtonLabel+"</span>",n.addEventListener("click",function(t){t.stopPropagation();var e=r._getEditChanges([i]);r._removeEditModeItems([i]),e&&e.length&&r._raiseEvent("data-change",e[0])}),t.appendChild(n);var o=document.createElement("button");o.classList.add("btn","btn-xs","btn-default","cancel-button"),o.innerHTML='<span class="text">'+e.cancelButtonLabel+"</span>",o.addEventListener("click",function(t){t.stopPropagation(),r._removeEditModeItems([i])}),t.appendChild(o)}}},{key:"_buildEditControl",value:function(t,a,i,r){var s=void 0;switch((a.dataType||"").toLowerCase()){default:case"string":case"url":!function(){var e=document.createElement("input");e.setAttribute("type","text"),e.value=i,e.classList.add("edit-control","edit-control-"+(a.dataType||"string")),t.appendChild(e),s=function(){return e.value}}();break;case"number":!function(){var e=document.createElement("input");e.setAttribute("type","number"),e.value=i,e.classList.add("edit-control","edit-control-number"),t.appendChild(e),s=function(){return parseInt(e.value)||0}}();break;case"date":!function(){var a=e._parseDate(i),r=document.createElement("input");r.setAttribute("type","date"),a&&(r.value=a.toISOString().substr(0,10)),r.classList.add("edit-control","edit-control-date"),t.appendChild(r),s=function(){return r.value}}();break;case"datetime":!function(){var a=isNaN(i)?i.substring(0,19):i,r=e._parseDate(a),n=document.createElement("input");n.setAttribute("type","date"),r&&(n.value=r.toISOString().substr(0,10)),n.classList.add("edit-control","edit-control-datetime","edit-control-datetime-date"),t.appendChild(n);var o=document.createElement("input");o.setAttribute("type","time"),r&&(o.value=e._renderTime(r)),o.classList.add("edit-control","edit-control-datetime","edit-control-datetime-time"),t.appendChild(o),s=function(){return n.value+"T"+o.value}}();break;case"boolean":!function(){var e=document.createElement("input");e.setAttribute("type","checkbox"),e.checked=!0===i,e.classList.add("edit-control","edit-control-boolean"),t.appendChild(e),s=function(){return e.checked}}()}"function"==typeof s&&(r[a.key]=s)}},{key:"_addEditModeItems",value:function(t){var e=this,a=this.model.cols.filter(function(t){return t.editable});if(0===a.length)throw new Error("You cannot put a grid into edit mode which has no columns that are editable");var i=!1;this.editManifest||(this.editManifest={itemIndexes:[]}),t.forEach(function(t){e._isEditItem(t)||(e.editManifest.itemIndexes.push(t),e.editManifest[t]={},i=!0)}),i&&this._buildDataRows(!0)}},{key:"_isEditItem",value:function(t){return!!this.editManifest&&this.editManifest.itemIndexes.includes(t)}},{key:"_getEditChanges",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.editManifest)return[];var a=[];return this.editManifest.itemIndexes.forEach(function(i){if(null===e||e.includes(i)){var r=Object.assign({},(t.localData||t.model.data)[i]),s=Object.assign({},r),n=t.editManifest[i];for(var o in n)n.hasOwnProperty(o)&&(s[o]=n[o]());var l=JSON.stringify(r)!==JSON.stringify(s);a.push({__idx:i,oldValue:r,newValue:s,hasChanged:l})}}),a}},{key:"_removeEditModeItems",value:function(t){var e=this;if(this.editManifest){var a=!1;t.forEach(function(t){e._isEditItem(t)&&(delete e.editManifest[t],a=!0)}),a&&(this.editManifest.itemIndexes=this.editManifest.itemIndexes.filter(function(e){return!t.includes(e)}),this._buildDataRows(!0))}}},{key:"_removeAllEditModeItems",value:function(){this.editManifest&&this._removeEditModeItems(this.editManifest.itemIndexes)}},{key:"__handleRowClick",value:function(t,e,a){var i=this._applyIndexes(e);if(!this._isEditItem(i.__idx)){var r=Array.from(this.$table.querySelectorAll(".selected"));r.forEach(function(t){t.classList.remove("selected")}),t.classList.add("selected"),this.selectedValue={rowData:i,rowIndex:a},this._raiseEvent("selection",this.selectedValue)}}},{key:"__handleCellClick",value:function(t,e,a,i,r){var s=this._applyIndexes(e);if(!this._isEditItem(s.__idx)){var n=Array.from(this.$table.querySelectorAll(".selected"));n.forEach(function(t){t.classList.remove("selected")}),t.parentNode.classList.add("selected"),t.classList.add("selected"),this.selectedValue={rowData:s,rowIndex:a,columnKey:i.key,columnIndex:r,cellData:e[i.key]},this._raiseEvent("selection",this.selectedValue)}}},{key:"_buildSearchArea",value:function(){var t=this;if(e._removeChildren(this.$searchArea),this.showSearch){this.$element.classList.add("has-search"),this.$searchArea.innerHTML='\n                    <div class="search-bar">\n                        <div class="search-box">\n                            <div class="input-group">\n                                <input type="text" class="form-control" placeholder="Search..." />\n                                <span class="input-group-btn">\n                                    <button class="btn btn-default search-button" type="button"><i class="fa fa-search"></i></button>                        \n                                </span>\n                            </div>\n                            <span class="clear-button">\n                                <i class="fa fa-remove"></i>\n                            </span>\n                        </div>\n                    </div>\n                ';var a=this.$searchArea.querySelector("input.form-control"),i=this.$searchArea.querySelector("button.search-button"),r=this.$searchArea.querySelector("span.clear-button");r.style.display="none";var s=function(){var e=a.value;t._changeSearch(e)};a.addEventListener("keyup",function(t){13===t.keyCode&&s(),r.style.display=0===a.value.length?"none":"inline"}),r.addEventListener("click",function(){a.value="",r.style.display="none",s()}),i.addEventListener("click",function(){s()})}else this.$element.classList.remove("has-search")}},{key:"_changeSearch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.searchQuery=t,this.pageNumber=1,e&&this.showSearch){var a=this.$searchArea.querySelector("input.form-control");a&&(a.value=t)}this._buildDataRows()}},{key:"_searchLocal",value:function(t){var e=this,a=(this.searchQuery||"").trim().toUpperCase();if(0<a.length){var i={};this.model.cols.forEach(function(t){i[t.key]=t}),t=t.filter(function(t){for(var r in t)if(t.hasOwnProperty(r)){var s=i[r];if(s){var n=e._formatData(s,t[r]||"");if(-1<n.toUpperCase().indexOf(a))return!0}}return!1})}return t}},{key:"_changeSort",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"switch",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Array.from(this.$table.querySelectorAll("th.sortable.sort-asc, th.sortable.sort-desc")),r="";null===t?i.forEach(function(t){return t.classList.remove("sort-asc","sort-desc")}):(r=t.getAttribute("key"),"switch"===e&&(e=t.classList.contains("sort-asc")?"desc":"asc"),i.forEach(function(t){return t.classList.remove("sort-asc","sort-desc")}),e&&"asc"===e.toString().toLowerCase()&&t.classList.add("sort-asc"),e&&"desc"===e.toString().toLowerCase()&&t.classList.add("sort-desc")),this.sortBy=r,this.sortDirection=e,!0!==a&&this._buildDataRows()}},{key:"_sortLocal",value:function(t){var a=this.sortBy,i="desc"===this.sortDirection,r=this.model.cols.find(function(t){return t.key===a});if(r&&r.sortable&&!r.isControls){switch((r.dataType||"").toLowerCase()){case"string":case"url":default:t.sort(function(t,e){var i=(t[a]||"").toString().toUpperCase(),r=(e[a]||"").toString().toUpperCase();return i.localeCompare(r)});break;case"number":t.sort(function(t,e){var i=t[a]||0,r=e[a]||0;return i<r?-1:i>r?1:0});break;case"date":case"datetime":t.sort(function(t,i){var r=void 0===t[a]||null===t[a]||""===t[a]?Number.MIN_SAFE_INTEGER:e._parseDate(t[a]).getTime(),s=void 0===i[a]||null===i[a]||""===i[a]?Number.MIN_SAFE_INTEGER:e._parseDate(i[a]).getTime();return isNaN(r)&&(r=Number.MIN_SAFE_INTEGER),isNaN(s)&&(s=Number.MIN_SAFE_INTEGER),r<s?-1:r>s?1:0});break;case"boolean":var s=function(t){return!0===t?0:!1===t?1:i?-1:2};t.sort(function(t,e){var i=s(t[a]),r=s(e[a]);return i<r?-1:i>r?1:0})}i&&t.reverse()}return t}},{key:"_buildPagination",value:function(){var t=this;if(e._removeChildren(this.$paginationArea),this.showPagination&&0<this.pageSize&&0<this.totalResults){this.$element.classList.add("has-pagination");var a=5,i=this._getTotalPages(),r=1,s=Math.min(a,i);if(i>a){var n=Math.ceil(a/2),o=n-1;this.pageNumber>n&&(r=this.pageNumber-o,s=this.pageNumber+o,s>i&&(s=i,r=s-a+1))}if(this.$paginationArea.innerHTML='\n                    <nav>\n                        <ul class="pagination pagination-sm"></ul>\n                    </nav>\n                ',1<i){var l=this.$paginationArea.querySelector(".pagination"),d=function(t){var e=t.html,a=t.active,i=void 0!==a&&a,r=t.enabled,s=void 0===r||r,n=t.handler,o=void 0===n?null:n,d=t.css,c=void 0===d?null:d,u=document.createElement("li");i&&u.classList.add("active"),s||u.classList.add("disabled"),c&&c.split(" ").forEach(function(t){return u.classList.add(t)});var h=document.createElement("a");return h.innerHTML=e,s&&"function"==typeof o&&h.addEventListener("click",o),u.appendChild(h),l.appendChild(u),h};d({html:'<span class="page-icon fa fa-step-backward"></span><span class="page-label"> First</span>',enabled:1<this.pageNumber,handler:function(){return t._changePage(1)},css:"page-first page-bookend"}),d({html:'<span class="page-icon fa fa-chevron-left"></span><span class="page-label"> Previous</span>',enabled:1<this.pageNumber,handler:function(){return t._changePage(t.pageNumber-1)},css:"page-prev page-bookend"});for(var c=function(e){d({html:'<span class="page-label">'+e+"</span>",active:t.pageNumber===e,handler:function(){return t._changePage(e)}})},u=r;u<=s;u++)c(u);d({html:'<span class="page-label">Next </span><span class="page-icon fa fa-chevron-right"></span>',enabled:this.pageNumber<i,handler:function(){return t._changePage(t.pageNumber+1)},css:"page-next page-bookend"}),d({html:'<span class="page-label">Last </span><span class="page-icon fa fa-step-forward"></span>',enabled:this.pageNumber<i,handler:function(){return t._changePage(i)},css:"page-last page-bookend"})}}else this.$element.classList.remove("has-pagination")}},{key:"_changePage",value:function(t){var e=this._getTotalPages();if(isNaN(t)||(t=parseInt(t)),"string"==typeof t)switch(t.toLowerCase()){case"first":t=1;break;case"previous":t=this.pageNumber-1;break;case"next":t=this.pageNumber+1;break;case"last":t=e}if("number"!=typeof t)throw new Error('Invalid page number: "'+t+'"');1>t&&(t=1),t>e&&0<e&&(t=e),this.pageNumber=t,this._buildDataRows(),this.fixedHeaders&&(this.$table.querySelector("tbody").scrollTop=0)}},{key:"_paginateLocal",value:function(t){if(0===this.pageSize)return t;this.totalResults=t.length;var e=this._getTotalPages();0<e&&(1>this.pageNumber&&(this.pageNumber=1),this.pageNumber>e&&(this.pageNumber=e));var a=this.pageSize*(this.pageNumber-1),i=a+this.pageSize;return t.slice(a,Math.min(i,this.totalResults))}},{key:"_getTotalPages",value:function(){return Math.ceil(this.totalResults/this.pageSize)}},{key:"_sendRequest",value:function(t,e,a){return new Promise(function(i,r){var s=(t||"GET").toUpperCase(),n=e,o=new XMLHttpRequest;if(o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status){var t=JSON.parse(o.response.toString());i(t)}else r(0===o.status?"Could not access "+e:"Error code "+o.status+' on "'+e+'"')},o.onerror=function(){r("There was a problem accessing "+e)},"GET"===s){var l=-1===n.indexOf("?")?"?":"&";Object.keys(a).filter(function(t){return a[t]}).forEach(function(t){n+=""+l+t+"="+encodeURIComponent(a[t]),l="&"})}o.open(s,n,!0),"GET"===s?o.send():(o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(JSON.stringify(a)))})}},{key:"_setData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.model.data=t}},{key:"_applyIndexes",value:function(t){var e=0==t instanceof Array;e&&(t=[t]);var a=JSON.parse(JSON.stringify(t)),i=this.localData||this.model.data||[];return t.forEach(function(t,e){
var r=i.indexOf(t);-1!==r&&(a[e].__idx=r)}),e?a[0]:a}},{key:"_setLoading",value:function(t){t?(this.$element.classList.add("loading-data"),this.$loading.innerHTML='<div class="bg"></div><div class="spinner"></div>'):(this.$element.classList.remove("loading-data"),e._removeChildren(this.$loading))}},{key:"_setMessage",value:function(t,a,i){e._removeChildren(this.$tbody);var r=document.createElement("tr");this.$tbody.appendChild(r);var s=document.createElement("td");s.classList.add("message-"+t),s.setAttribute("colspan",this.model.cols.length.toString()),r.appendChild(s);var n=document.createElement("div");n.classList.add("content"),n.textContent=a,i&&(n.innerHTML+='<div class="message-detail">'+i+"</div>"),s.appendChild(n)}},{key:"_raiseEvent",value:function(t,e){var a=this,i=e?{detail:e}:null,r=new CustomEvent(t,i);setTimeout(function(){a.dispatchEvent(r)},0)}},{key:"setData",value:function(t){if(this.useDataSource)throw new Error("Cannot set data on a data grid which uses a data source");Array.isArray(t)&&(this.localData=t,this.unfilteredTotalResults=t.length,this.totalResults=t.length,this._setData(t),this._buildDataRows())}},{key:"getSearch",value:function(){return{query:this.searchQuery||"",totalResults:this.totalResults,unfilteredTotalResults:this.unfilteredTotalResults}}},{key:"setSearch",value:function(t){(null===t||void 0===t)&&(t=""),"string"!=typeof t&&(t=t.toString()),this._changeSearch(t,!0)}},{key:"getSort",value:function(){return{column:this.sortBy,direction:this.sortDirection}}},{key:"setSort",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"switch";if(null===t){var a=this.model.cols.find(function(t){return!!t.sort});a&&(t=a.key,e=a.sort)}if(t){var i=this.model.cols.filter(function(e){return e.key===t})[0];if(!i)throw new Error('Unable to sort by column "'+t+'" - data grid does not have a column with that key');if(!i.sortable)throw new Error('Unable to sort by column "'+t+'" - that column is not defined as sortable');var r=this.$table.querySelector('th[key="'+t+'"]');this._changeSort(r,e)}else this._changeSort(null)}},{key:"getPage",value:function(){if(!this.pageSize)return null;var t=this._getTotalPages();return{number:this.pageNumber,total:this._getTotalPages(),pageSize:this.pageSize,isFirst:1===this.pageNumber,hasPrevious:1<this.pageNumber,hasNext:this.pageNumber<t,isLast:this.pageNumber===t}}},{key:"setPage",value:function(t){if(!this.pageSize)throw new Error("Cannot change page on a data grid which doesn't use pagination");null===t&&(t=1),this._changePage(t)}},{key:"getVisibleData",value:function(){return this._applyIndexes(this.model.data||[])}},{key:"edit",value:function(t){var e=this;if(void 0===t||null===t)throw new Error("You must specify the indexes or items of data to put into edit mode");0==t instanceof Array&&(t=[t]);var a=t.map(function(t){return"number"==typeof t?t:(e.localData||e.model.data||[]).indexOf(t)}).filter(function(t){return-1!==t});this._addEditModeItems(a)}},{key:"finishedEdit",value:function(){var t=this._getEditChanges();return this._removeAllEditModeItems(),t}},{key:"value",get:function(){return this.selectedValue}}],[{key:"_parseDate",value:function(t){var e=null;if(/[0-9]{4}-[0-9]{2}-[0-9]{2}/.test(t)){if(e=new Date(t),isNaN(e.valueOf())){var a=t.replace(/-/g,"/").replace("T"," ");e=new Date(a)}}else e=new Date(t);return!e||isNaN(e.valueOf())?null:e}},{key:"_renderDate",value:function(t){return!t||isNaN(t.valueOf())?"":new Date(t.getTime()+1e3*(60*t.getTimezoneOffset())).toLocaleDateString("en-GB")}},{key:"_renderTime",value:function(t){return!t||isNaN(t.valueOf())?"":new Date(t.getTime()+1e3*(60*t.getTimezoneOffset())).toLocaleTimeString("en-GB")}},{key:"_getProperty",value:function(t,e){e=e.replace(/\[(\w+)]/g,".$1").replace(/^\./,"");for(var a=t,i=e;a&&0<i.length;){var r=i.indexOf(".");if(-1<r){var s=i.substring(0,r);a=a[s],i=i.substring(r+1)}else a=a[i],i=""}return a}},{key:"_removeChildren",value:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}},{key:"observedAttributes",get:function(){return["data-source","data-source-method","data-source-page-param","data-source-page-size-param","data-source-search-param","data-source-sort-column-param","data-source-sort-direction-param","data-results-property","data-results-total-property","show-search","show-pagination","page-size","use-local-interaction","fixed-headers","row-css-key","selection-mode"]}}]),e}(HTMLElement))}();